define(["jquery"],function(i){function t(t){var n=i(".imgs"),e=i(".icons").find("li"),o=n.find("li"),l=e.length,a=t.width(),r=t.find(".left"),s=t.find(".right");this.statuscollection={imgul:n,imgsli:o,nowli:e,li_len:l,rollFlag:!1,now_index:0,new_index:0,width:a,setTime:-1,left:r,right:s}}return t.prototype={gotonext:function(i){var t=this.statuscollection;t.new_index=(t.now_index+i)%t.li_len,t.nowli.eq(t.new_index).addClass("bg").siblings().removeClass("bg"),t.imgul.animate({left:"-="+t.width*i},1e3,function(){0==t.new_index&&t.imgul.css("left",-1*t.width),t.now_index=t.new_index,t.rollFlag=!1})},goback:function(i){var t=this.statuscollection;t.new_index=(t.now_index-i+t.li_len)%t.li_len,t.nowli.eq(t.new_index).addClass("bg").siblings().removeClass("bg"),t.imgul.animate({left:"+="+t.width*i},1e3,function(){t.new_index==t.li_len-1&&t.imgul.css("left",t.width*t.li_len*-1),t.now_index=t.new_index,t.rollFlag=!1})},rollStart:function(){var i=this;this.statuscollection.setTime=setInterval(function(){i.gotonext(1)},4e3)},bindEvent:function(){var t=this,n=this.statuscollection;n.right.on("click",function(){n.rollFlag||(n.rollFlag=!0,clearInterval(n.setTime),t.gotonext(1),t.rollStart())}),n.left.on("click",function(){n.rollFlag||(n.rollFlag=!0,clearInterval(n.setTime),t.goback(1),t.rollStart())}),n.nowli.on("click",function(){var e=i(this).index();n.rollFlag||(clearInterval(n.setTime),n.rollFlag=!0,e>n.now_index&&t.gotonext(e-n.now_index),e<n.now_index&&t.goback(n.now_index-e),t.rollStart())});var e=n.imgsli.eq(0).clone(),o=n.imgsli.eq(n.li_len-1).clone();n.imgul.prepend(o),n.imgul.append(e),n.imgul.css("left",-1*n.width),n.imgul.css("width",n.width*(n.li_len+2)),n.imgul.find("li").width(n.width),t.rollStart()}},t}),define(["jquery"],function(i){function t(i,t){this.$node=i,this.tap=t,this.BindEvent()}return t.prototype={isVisible:function(t){var n=t.height(),e=i(document).scrollTop(),o=t.offset().top,l=i(window).height();return l+e>o&&e<o+n},loadimgs:function(t,n){var e=this,o=n+"[flag=0]";t.find(o).each(function(){var t=i(this);e.isVisible(t)&&(t.animate({opacity:1},1e3),t.attr("flag",1))})},BindEvent:function(){var t=this;t.$node.find(t.tap).attr("flag",0),t.loadimgs(t.$node,t.tap),i(document).on("scroll",function(){t.loadimgs(t.$node,t.tap)})}},t}),define(["jquery"],function(i){function t(t){this.ct=t?t:i("body"),this.createNode=function(){var t=i('<a href="javascript:void(0)">TOP</a>');return t.css({display:"block",width:"50px",height:"30px",border:"1px solid #eee","line-height":"30px",position:"fixed",bottom:"10px",right:"10px","text-align":"center","text-decoration":"none",color:"#555",display:"none"}),this.ct.append(t),t},this.target=this.createNode(),this.bindEvent()}return t.prototype={bindEvent:function(){var t=this;i(document).on("scroll",function(){i(document).scrollTop()>200?t.target.show():t.target.hide()}),t.target.on("click",function(){i(document).scrollTop(0)})}},t}),define(["jquery"],function(i){function t(t,n){this.$con=t,this.verwidth=this.$con.find("li").outerWidth(!0);var e=i(window).width();this.len=Math.floor(e/this.verwidth),this.imgs=[],this.index=0,this.page=1,this.$loadbtn=n}return t.prototype={imgsort:function(t){var n=this;if(n.imgs.length<=0)for(var e=0;e<n.len;e++)n.imgs[e]=0;t.each(function(){$item=i(this),index=n.findmin(n.imgs),$item.css({left:index*n.verwidth,top:n.imgs[index]}),n.imgs[index]+=$item.outerHeight(!0),n.$con.height(n.imgs[index])})},getdataquery:function(t){var n=this;i.ajax({type:"get",async:!1,url:"http://platform.sina.com.cn/slide/album_tech?jsoncallback=?&app_key=1271687855&num=6&page="+t,dataType:"jsonp",jsonp:"jsonpcallback",success:function(i){n.appenddata(i)},error:function(){alert("fail")}})},appenddata:function(t){var n=this,e=t.data,o="";for(var l in e)o+='<li><a href="'+e[l].url+'"><img src="'+e[l].img_url+'" alt=""></a><p>'+e[l].short_name+"</p><p>"+e[l].name+"</p></li>";var a=i(o),r=[];n.$con.append(a),a.find("img").each(function(){var t=i.Deferred();r.push(t);var n=i(this);n.load(function(){t.resolve()})}),i.when.apply(null,r).done(function(){n.imgsort(a)})},findmin:function(i){for(var t=i[0],n=0,e=0;e<i.length;e++)t>i[e]&&(t=i[e],n=e);return n},bindEvent:function(){var i=this;this.$loadbtn.on("click",function(){i.page++,i.getdataquery(i.page)}),i.getdataquery(i.page)}},t});